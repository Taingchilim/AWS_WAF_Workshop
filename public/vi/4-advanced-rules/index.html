<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.69.0" />
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Rule Tùy chỉnh (Nâng cao) :: AWS Web Application Firewall</title>

    
    <link href="/css/nucleus.css?1626076638" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1626076638" rel="stylesheet">
    <link href="/css/hybrid.css?1626076638" rel="stylesheet">
    <link href="/css/featherlight.min.css?1626076638" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1626076638" rel="stylesheet">
    <link href="/css/auto-complete.css?1626076638" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1626076638" rel="stylesheet">
    <link href="/css/theme.css?1626076638" rel="stylesheet">
    <link href="/css/hugo-theme.css?1626076638" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1626076638" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1626076638"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/vi/4-advanced-rules/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1626076638"></script>
<script type="text/javascript" src="/js/auto-complete.js?1626076638"></script>
<script type="text/javascript">
    
        var baseurl = "\/vi";
    
</script>
<script type="text/javascript" src="/js/search.js?1626076638"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/vi/1-prerequiste/" title="Các bước chuẩn bị" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-prerequiste/">
          <b>1. </b>Các bước chuẩn bị
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/2-acls-managed-rules/" title="Web ACLs and Managed Rules" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-acls-managed-rules/">
          <b>2. </b>Web ACLs and Managed Rules
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/2-acls-managed-rules/1-challenges/" title="Web ACLs and Managed Rules" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-acls-managed-rules/1-challenges/">
          <b>2. </b>Web ACLs and Managed Rules
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/3-custom-rules/" title="Các Rule Tùy chỉnh" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-custom-rules/">
          <b>3. </b>Các Rule Tùy chỉnh
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/3-custom-rules/1-challenges/" title="Thử thách ACL và Rule" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-custom-rules/1-challenges/">
          <b>3.1. </b>Thử thách ACL và Rule
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/4-advanced-rules/" title="Rule Tùy chỉnh (Nâng cao)" class="dd-item 
        
        active
        
        ">
      <a href="/vi/4-advanced-rules/">
          <b>4. </b>Rule Tùy chỉnh (Nâng cao)
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/4-advanced-rules/1-challenges/" title="Thử thách Rule Nâng cao" class="dd-item 
        
        
        
        ">
      <a href="/vi/4-advanced-rules/1-challenges/">
          <b>4.1. </b>Thử thách Rule Nâng cao
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/5-testing/" title="Kiểm thử Rule mới" class="dd-item 
        
        
        
        ">
      <a href="/vi/5-testing/">
          <b>5. </b>Kiểm thử Rule mới
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/5-testing/1-challenges/" title="Thử thách" class="dd-item 
        
        
        
        ">
      <a href="/vi/5-testing/1-challenges/">
          <b>5.1. </b>Thử thách
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/6-logging/" title="Logging" class="dd-item 
        
        
        
        ">
      <a href="/vi/6-logging/">
          <b>6. </b>Logging
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/6-logging/1-challenges/" title="Cấu hình Log" class="dd-item 
        
        
        
        ">
      <a href="/vi/6-logging/1-challenges/">
          <b>6.1. </b>Cấu hình Log
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/7-clean-up/" title="Thu hồi tài nguyên" class="dd-item 
        
        
        
        ">
      <a href="/vi/7-clean-up/">
          <b>7. </b>Thu hồi tài nguyên
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="http://awsstudygroup.com"><i class='fab fa-aws'></i> AWS Study Group - Blog</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/660548818043427/"><i class='fab fa-facebook'></i> AWS Study Group - Nhóm FB</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="/4-advanced-rules/">English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="/vi/4-advanced-rules/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7837680&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='/vi/'>AWS Web Application Firewall</a> > Rule Tùy chỉnh (Nâng cao)
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Rule Tùy chỉnh (Nâng cao)
            </h1>
          

        



	<p>You’ve created a simple WAF rule that evaluates one part of a request. How could you create a rule to evaulate multiple parts of a request?</p>
<p><strong>Contents:</strong></p>
<ul>
<li><a href="#%C4%91%E1%BB%8Bnh-ngh%C4%A9a-rule-b%E1%BA%B1ng-json">Định nghĩa Rule bằng JSON</a></li>
<li><a href="#logic-lu%E1%BA%ADn-l%C3%BD-trong-rule">Logic luận lý trong Rule</a></li>
<li><a href="#v%C3%AD-d%E1%BB%A5">Ví dụ</a></li>
</ul>
<h4 id="định-nghĩa-rule-bằng-json">Định nghĩa Rule bằng JSON</h4>
<p>Tất cả WAF Rule được định nghĩa là một JSON Object. Đối với các rule phức tạp, bạn sẽ dễ dàng xử lý hơn nếu làm việc trực tiếp ở định dạng JSON thay vì sử dụng Rule Editor trên console. Bạn có thể lấy các thông tin của rule hiện tại được định nghĩa bằng JSON thông qua sử dụng bằng API, CLI hoặc Console sử dụng lệnh <a href="https://docs.aws.amazon.com/cli/latest/reference/wafv2/get-rule-group.html">get-rule-group</a>. Chỉnh sửa chúng sử dụng trình biên soạn JSON mà bạn muốn và tải chúng lên với lệnh <a href="https://docs.aws.amazon.com/cli/latest/reference/wafv2/update-rule-group.html">update-rule-group</a> sử dụng API, CLI hoặc Console.</p>
<p>Định nghĩa rule sử dụng JSON cho phép bạn áp dụng việc quản lý phiên bản nhằm dễ dàng xem xét cách thức, thời điểm và lý do một tập các rule phức tạp được thay đổi.</p>

<div class="notices tip" ><p>Cấu trúc để định nghĩa rule trong JSON được cung cấp trong tài liệu <a href="https://docs.aws.amazon.com/cli/latest/reference/wafv2/update-rule-group.html">update-rule-group</a></p>
</div>

<p>Nếu bạn chưa chắc chắn về cấu trúc, bạn có thể sử dụng Console visual editor để tạo một rule đơn giản sau đó chuyển sang JSON editor để xem dưới dạng JSON.</p>
<h4 id="logic-luận-lý-trong-rule">Logic luận lý trong Rule</h4>
<p>Các toán tử <code>AND</code>, <code>OR</code> và <code>NOT</code> có thể được sử dụng cho các trường hợp phức tạp. Việc này sẽ hữu ích khi phân tích nhiều phần của một request. Ví dụ như bạn có thể chỉ cho phép một request nếu như chuỗi truy xuất hoặc header chứa một khóa/giá trị nhất định.</p>

<div class="notices tip" ><p>Các rule lồng nhau có thể được tạo ra sử dụng visual editor. Tuy nhiên chúng chỉ giới hạn ở 1 lớp lồng nhau.<br>
Để tạo các rule lồng nhau tùy biến trong console, bạn bắt buộc phải sử dụng JSON.<br>
Sử dụng lựa chọn Validate để kiểm tra tính chính xác của rule đó.</p>
</div>

<p>Bên dưới là một ví dụ của rule được tạo trong console. Rule này sẽ chặn các request với chuỗi truy xuất với độ dài lớn hơn hoặc bằng 0.</p>

<div class="notices info" ><p>Rule này sẽ chặn tất cả các request chứa chuỗi truy xuất dữ liệu.</p>
</div>

<p>Đây là rule được tạo dưới định dạng JSON.</p>
<ul>
<li>Các hành động được xác định bởi hành động của WAF nếu request chính xác với định nghĩa của rule.</li>
<li>VisibilityConfig được sử dụng để cấu hình các mẫu request và CloudWatch metrics</li>
<li>Statement định nghĩa các điều kiện để đánh giá rule.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;example-rule-01&#34;</span>,
  <span style="color:#f92672">&#34;Priority&#34;</span>: <span style="color:#ae81ff">0</span>,
  <span style="color:#f92672">&#34;Action&#34;</span>: {
    <span style="color:#f92672">&#34;Block&#34;</span>: {}
  },
  <span style="color:#f92672">&#34;VisibilityConfig&#34;</span>: {
    <span style="color:#f92672">&#34;SampledRequestsEnabled&#34;</span>: <span style="color:#66d9ef">true</span>,
    <span style="color:#f92672">&#34;CloudWatchMetricsEnabled&#34;</span>: <span style="color:#66d9ef">true</span>,
    <span style="color:#f92672">&#34;MetricName&#34;</span>: <span style="color:#e6db74">&#34;example-rule-01&#34;</span>
  },
  <span style="color:#f92672">&#34;Statement&#34;</span>: {
    <span style="color:#f92672">&#34;SizeConstraintStatement&#34;</span>: {
      <span style="color:#f92672">&#34;FieldToMatch&#34;</span>: {
        <span style="color:#f92672">&#34;QueryString&#34;</span>: {}
      },
      <span style="color:#f92672">&#34;ComparisonOperator&#34;</span>: <span style="color:#e6db74">&#34;GT&#34;</span>,
      <span style="color:#f92672">&#34;Size&#34;</span>: <span style="color:#e6db74">&#34;0&#34;</span>,
      <span style="color:#f92672">&#34;TextTransformations&#34;</span>: [
        {
          <span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;NONE&#34;</span>,
          <span style="color:#f92672">&#34;Priority&#34;</span>: <span style="color:#ae81ff">0</span>
        }
      ]
    }
  }
}
</code></pre></div><h4 id="ví-dụ">Ví dụ</h4>
<p>Đồng nghiệp của bạn đang cần tư vấn của bạn, khi họ đang gặp phải một tấn công. Họ cần chặn các request tấn công đồng thời không chặn các request đến từ các khách hàng thực sự của họ. Các request tấn công chứa nội dung có kích thước lớn hơn 100KB, không có header x-upload-photo: true.</p>
<p>Bạn nhanh chóng nhận ra không thể định nghĩa rule này sử dụng rule editor ở giao diện console. Bạn cần phải sử dụng đến JSON.</p>
<p>Bạn bắt đầu với một rule trắng:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;example-rule-02&#34;</span>,
  <span style="color:#f92672">&#34;Priority&#34;</span>: <span style="color:#ae81ff">0</span>,
  <span style="color:#f92672">&#34;Action&#34;</span>: {
    <span style="color:#f92672">&#34;Block&#34;</span>: {}
  },
  <span style="color:#f92672">&#34;VisibilityConfig&#34;</span>: {
    <span style="color:#f92672">&#34;SampledRequestsEnabled&#34;</span>: <span style="color:#66d9ef">true</span>,
    <span style="color:#f92672">&#34;CloudWatchMetricsEnabled&#34;</span>: <span style="color:#66d9ef">true</span>,
    <span style="color:#f92672">&#34;MetricName&#34;</span>: <span style="color:#e6db74">&#34;example-rule-02&#34;</span>
  },
  <span style="color:#f92672">&#34;Statement&#34;</span>: {
    <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">Chúng</span> <span style="color:#960050;background-color:#1e0010">ta</span> <span style="color:#960050;background-color:#1e0010">sẽ</span> <span style="color:#960050;background-color:#1e0010">định</span> <span style="color:#960050;background-color:#1e0010">nghĩa</span> <span style="color:#960050;background-color:#1e0010">các</span> <span style="color:#960050;background-color:#1e0010">statement</span> <span style="color:#960050;background-color:#1e0010">ở</span> <span style="color:#960050;background-color:#1e0010">đây</span>
  }
}
</code></pre></div><p>Có hai trường hợp cần phải cân nhắc như sau:</p>
<ol>
<li>Nếu như nội dung request lớn hơn 100KB, chặn request đó.</li>
<li>Nếu như header của request không chứa cặp khóa/giá trị <code>x-upload-body: true</code>, chặn request đó.</li>
</ol>
<p>Chúng ta sẽ cần phải sử dụng đến <a href="https://docs.aws.amazon.com/waf/latest/developerguide/waf-rule-statement-type-or.html">OrStatement</a> và <a href="https://docs.aws.amazon.com/waf/latest/developerguide/waf-rule-statement-type-not.html">NotStatement</a> để mô tả phần logic này.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
<span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">fields</span> <span style="color:#960050;background-color:#1e0010">omitted</span> <span style="color:#960050;background-color:#1e0010">for</span> <span style="color:#960050;background-color:#1e0010">brevity</span>
<span style="color:#f92672">&#34;Statement&#34;</span>: {
  <span style="color:#f92672">&#34;OrStatement&#34;</span>: {
    <span style="color:#f92672">&#34;Statements&#34;</span>: [
      {
        <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">Inspect</span> <span style="color:#960050;background-color:#1e0010">Body</span> <span style="color:#960050;background-color:#1e0010">Size</span> <span style="color:#960050;background-color:#1e0010">here</span>
      },
      {
        <span style="color:#f92672">&#34;NotStatement&#34;</span>: {
           <span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#960050;background-color:#1e0010">Inspect</span> <span style="color:#960050;background-color:#1e0010">Header</span> <span style="color:#960050;background-color:#1e0010">here</span>
        }
      }
    ]
  }
}
</code></pre></div><p>Để phân tích kích thước nội dung, chúng ta sẽ sử dụng SizeConstraintStatement để xem xét request.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#e6db74">&#34;SizeConstraintStatement&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
  <span style="color:#f92672">&#34;FieldToMatch&#34;</span>: {
    <span style="color:#f92672">&#34;Body&#34;</span>: {}
  },
  <span style="color:#f92672">&#34;ComparisonOperator&#34;</span>: <span style="color:#e6db74">&#34;GT&#34;</span>,
  <span style="color:#f92672">&#34;Size&#34;</span>: <span style="color:#e6db74">&#34;100&#34;</span>,
  <span style="color:#f92672">&#34;TextTransformations&#34;</span>: [
    {
      <span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;NONE&#34;</span>,
      <span style="color:#f92672">&#34;Priority&#34;</span>: <span style="color:#ae81ff">0</span>
    }
  ]
}

</code></pre></div><p>Để phân tích Header của request, chúng ta sẽ sử dụng ByteMatchStatement.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#e6db74">&#34;ByteMatchStatement&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
  <span style="color:#f92672">&#34;FieldToMatch&#34;</span>: {
    <span style="color:#f92672">&#34;SingleHeader&#34;</span>: {
      <span style="color:#f92672">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;x-upload-image&#34;</span>
    }
  },
  <span style="color:#f92672">&#34;PositionalConstraint&#34;</span>: <span style="color:#e6db74">&#34;EXACTLY&#34;</span>,
  <span style="color:#f92672">&#34;SearchString&#34;</span>: <span style="color:#e6db74">&#34;true&#34;</span>,
  <span style="color:#f92672">&#34;TextTransformations&#34;</span>: [
    {
      <span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;NONE&#34;</span>,
      <span style="color:#f92672">&#34;Priority&#34;</span>: <span style="color:#ae81ff">0</span>
    }
  ]
}
</code></pre></div><p>Và cuối cùng chúng ta sẽ được rule như sau:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;complex-rule-example&#34;</span>,
  <span style="color:#f92672">&#34;Priority&#34;</span>: <span style="color:#ae81ff">0</span>,
  <span style="color:#f92672">&#34;Action&#34;</span>: {
    <span style="color:#f92672">&#34;Block&#34;</span>: {}
  },
  <span style="color:#f92672">&#34;VisibilityConfig&#34;</span>: {
    <span style="color:#f92672">&#34;SampledRequestsEnabled&#34;</span>: <span style="color:#66d9ef">true</span>,
    <span style="color:#f92672">&#34;CloudWatchMetricsEnabled&#34;</span>: <span style="color:#66d9ef">true</span>,
    <span style="color:#f92672">&#34;MetricName&#34;</span>: <span style="color:#e6db74">&#34;complex-rule-example&#34;</span>
  },
  <span style="color:#f92672">&#34;Statement&#34;</span>: {
    <span style="color:#f92672">&#34;OrStatement&#34;</span>: {
      <span style="color:#f92672">&#34;Statements&#34;</span>: [
        {
          <span style="color:#f92672">&#34;SizeConstraintStatement&#34;</span>: {
            <span style="color:#f92672">&#34;FieldToMatch&#34;</span>: {
              <span style="color:#f92672">&#34;Body&#34;</span>: {}
            },
            <span style="color:#f92672">&#34;ComparisonOperator&#34;</span>: <span style="color:#e6db74">&#34;GT&#34;</span>,
            <span style="color:#f92672">&#34;Size&#34;</span>: <span style="color:#e6db74">&#34;100&#34;</span>,
            <span style="color:#f92672">&#34;TextTransformations&#34;</span>: [
              {
                <span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;NONE&#34;</span>,
                <span style="color:#f92672">&#34;Priority&#34;</span>: <span style="color:#ae81ff">0</span>
              }
            ]
          }
        },
        {
          <span style="color:#f92672">&#34;NotStatement&#34;</span>: {
            <span style="color:#f92672">&#34;Statement&#34;</span>: {
              <span style="color:#f92672">&#34;ByteMatchStatement&#34;</span>: {
                <span style="color:#f92672">&#34;FieldToMatch&#34;</span>: {
                  <span style="color:#f92672">&#34;SingleHeader&#34;</span>: {
                    <span style="color:#f92672">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;x-upload-body&#34;</span>
                  }
                },
                <span style="color:#f92672">&#34;PositionalConstraint&#34;</span>: <span style="color:#e6db74">&#34;EXACTLY&#34;</span>,
                <span style="color:#f92672">&#34;SearchString&#34;</span>: <span style="color:#e6db74">&#34;true&#34;</span>,
                <span style="color:#f92672">&#34;TextTransformations&#34;</span>: [
                  {
                    <span style="color:#f92672">&#34;Type&#34;</span>: <span style="color:#e6db74">&#34;NONE&#34;</span>,
                    <span style="color:#f92672">&#34;Priority&#34;</span>: <span style="color:#ae81ff">0</span>
                  }
                ]
              }
            }
          }
        }
      ]
    }
  }
}
</code></pre></div>




<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/vi/3-custom-rules/1-challenges/" title="Thử thách ACL và Rule"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/vi/4-advanced-rules/1-challenges/" title="Thử thách Rule Nâng cao" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1626076638"></script>
    <script src="/js/perfect-scrollbar.min.js?1626076638"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1626076638"></script>
    <script src="/js/jquery.sticky.js?1626076638"></script>
    <script src="/js/featherlight.min.js?1626076638"></script>
    <script src="/js/highlight.pack.js?1626076638"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1626076638"></script>
    <script src="/js/learn.js?1626076638"></script>
    <script src="/js/hugo-learn.js?1626076638"></script>

    <link href="/mermaid/mermaid.css?1626076638" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1626076638"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
